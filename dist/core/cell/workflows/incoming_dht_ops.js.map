{"version":3,"file":"incoming_dht_ops.js","sourceRoot":"","sources":["../../../../src/core/cell/workflows/incoming_dht_ops.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,eAAe,EAAE,MAAM,4BAA4B,CAAC;AAQ7D,OAAO,EAAwB,qBAAqB,EAAE,MAAM,UAAU,CAAC;AACvE,OAAO,EAAE,uBAAuB,EAAE,MAAM,YAAY,CAAC;AACrD,OAAO,EAAE,mBAAmB,EAAE,MAAM,kBAAkB,CAAC;AAEvD,2HAA2H;AAC3H,MAAM,CAAC,MAAM,gBAAgB,GAAG,CAC9B,KAAW,EACX,MAAyB,EACzB,UAAmC,EACnC,EAAE,CAAC,KAAK,EAAE,IAAU,EAAiB,EAAE;IACvC,KAAK,MAAM,SAAS,IAAI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;QAC3C,MAAM,KAAK,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC;QAEhC,MAAM,oBAAoB,GAAyB;YACjD,KAAK;YACL,UAAU;YACV,QAAQ,EAAE,SAAS;YACnB,SAAS,EAAE,CAAC;YACZ,EAAE,EAAE,KAAK;YACT,MAAM,EAAE,qBAAqB,CAAC,OAAO;YACrC,UAAU,EAAE,IAAI,CAAC,GAAG,EAAE;SACvB,CAAC;QAEF,uBAAuB,CAAC,eAAe,CAAC,SAAS,CAAC,EAAE,oBAAoB,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;KACvF;IAED,IAAI,CAAC,eAAe,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC,CAAC;AAClD,CAAC,CAAC","sourcesContent":["import { deserializeHash } from '@holochain-open-dev/common';\nimport {\n  Hash,\n  Dictionary,\n  DHTOp,\n  AgentPubKey,\n} from '@holochain-open-dev/core-types';\nimport { Cell } from '../../cell';\nimport { ValidationLimboValue, ValidationLimboStatus } from '../state';\nimport { putValidationLimboValue } from '../dht/put';\nimport { sys_validation_task } from './sys_validation';\n\n// From https://github.com/holochain/holochain/blob/develop/crates/holochain/src/core/workflow/incoming_dht_ops_workflow.rs\nexport const incoming_dht_ops = (\n  basis: Hash,\n  dhtOps: Dictionary<DHTOp>,\n  from_agent: AgentPubKey | undefined\n) => async (cell: Cell): Promise<void> => {\n  for (const dhtOpHash of Object.keys(dhtOps)) {\n    const dhtOp = dhtOps[dhtOpHash];\n\n    const validationLimboValue: ValidationLimboValue = {\n      basis,\n      from_agent,\n      last_try: undefined,\n      num_tries: 0,\n      op: dhtOp,\n      status: ValidationLimboStatus.Pending,\n      time_added: Date.now(),\n    };\n\n    putValidationLimboValue(deserializeHash(dhtOpHash), validationLimboValue)(cell.state);\n  }\n\n  cell.triggerWorkflow(sys_validation_task(cell));\n};\n"]}